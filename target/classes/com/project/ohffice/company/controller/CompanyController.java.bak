package com.project.ohffice.company.controller;

import java.util.HashMap;

import javax.servlet.http.HttpSession;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.servlet.ModelAndView;

import com.project.ohffice.company.model.service.CompanyService;
import com.project.ohffice.company.model.vo.Company;
import com.project.ohffice.employee.model.service.EmpService;
import com.project.ohffice.employee.model.vo.Employee;

@Controller
public class CompanyController {

	@Autowired
	private CompanyService companyService;
	@Autowired
	private EmpService empService;

	@RequestMapping(value = "comp.do", method = RequestMethod.POST)
	private ModelAndView insertCompany(Company comp, ModelAndView mv,HashMap map,HttpSession session){
		
		System.out.println(comp);
		map.put("com_url", comp.getCom_url());
		map.put("emp_email", comp.getEmp_email());
		if( companyService.insertComp(comp)>0){
			empService.updateCompanyEmployee(map);
			mv.addObject("company",comp);
			String emp_email = comp.getEmp_email();
		      Employee loginUser = empService.selectEmp(emp_email);      
		      session.setAttribute("loginUser", loginUser);
			mv.setViewName("loading");
	}else{
			
			System.out.println("생성실패");
		}
		return mv;
	}

	@RequestMapping(value = "company")
	private ModelAndView showCompany(ModelAndView mv) {
		mv.setViewName("menu/main");
		return mv;

	}

}
